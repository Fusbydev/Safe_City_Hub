{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SafeCity Hub - View Report</title>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <style>
    /* Make sure the map container takes full width and adjusts height */
    #map {
      width: 100%;
      /* Full width */
      height: 400px;
      /* Set default height */
    }

    /* Adjust the map's height on smaller screens */
    @media (max-width: 768px) {
      #map {
        height: 300px;
        /* Smaller height for mobile */
      }
    }

    /* Adjust the map's height on very small screens */
    @media (max-width: 480px) {
      #map {
        height: 250px;
        /* Even smaller height */
      }
    }
  </style>
</head>

<body class="admin-view">
  <header class="admin-header">
    <div class="logo-container">
      <img src="{% static 'assets/logo_safe.png' %}" alt="SafeCity Logo" class="header-logo"
        style="height: 60px; width: auto;">
      <h1>SafeCity Hub</h1>
    </div>
    <a href="dashboard.html" class="btn header-btn">Back to Dashboard</a>
  </header>

  <div class="main-content-admin">
    <div class="admin-container">
      <div class="container d-flex">
        <div class="report-view">
          <div class="report-title-section">
            <h2>{{ report.incident_type }}</h2>
            <span class="status-badge status-review">{{ report.status }}</span>
          </div>
          <div class="report-id-section">Report id: {{ report.id }}</div>
  
          <div class="report-details">
            <div class="detail-item">
              <div class="detail-label">Type:</div>
              <div class="detail-value">{{ report.incident_type }}</div>
            </div>
  
            <div class="detail-item">
              <div class="detail-label">Date Reported:</div>
              <div class="detail-value">{{ report.date }}</div>
            </div>
  
            <div class="detail-item">
              <div class="detail-label">Location:</div>
              <div class="detail-value">{{ report.address }}</div>
              <input type="text" value="{{ report.longitude }}" id="longitude" hidden>
              <input type="text" value="{{ report.latitude }}" id="latitude" hidden>
            </div>
  
            <div class="detail-item">
              <div class="detail-label">Reported by:</div>
              {% if report.anonymous == false %}{{ username }}{% else %}Anonymous{% endif %}
            </div>
  
            <div class="detail-item">
              <div class="detail-label">Contact information:</div>
              <div class="detail-value">{{ report.contact_number }}</div>
            </div>
  
            <div class="detail-item">
              <div class="detail-label">Description:</div>
              <div class="detail-value">{{ report.description }}</div>
            </div>
          </div>
  
          <div class="report-section">
            <h3>Report Location</h3>
            <div class=" mt-5 pt-5">
              <div id="map"></div>
            </div>
          </div>
  
          <div class="report-section">
            <h3>Evidence Photos</h3>
            <div class="evidence-photos">
              {% if proof_url %}
              <div class="evidence-photo">
                <img src="{{ proof_url }}" alt="Evidence Photo" class="evidence-img">
              </div>
              {% else %}
              <p>No proof uploaded.</p>
              {% endif %}
            </div>
          </div>
  
          
          <div class="action-buttons admin-actions">
            <button class="btn btn-secondary">Cancel</button>
            {% if user.is_superuser %}
            <a href="{% url 'update_report' report.id %}" class="btn btn-primary">Update Report</a>
            {% endif %}
          </div>
        </div>
        <div class="comment-section">
          <h3>Comments</h3>
          {% for comment in comments %}
          <div class="comment">
            <p class="fw-bold">{{ comment.text }}</p>
            <p class="text-muted">{{ comment.timestamp }}</p>
          </div>
          {% empty %}
          <p>No comments yet.</p>
          {% endfor %}
        </div>
      </div>

    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Get the values of latitude and longitude
    var latitude = parseFloat(document.getElementById('latitude').value);
    var longitude = parseFloat(document.getElementById('longitude').value);

    // Initialize the map
    var map = L.map('map').setView([latitude, longitude], 13); // Default zoom level is 13

    // Add a tile layer to the map (you can use other providers if you prefer)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add a marker at the given coordinates
    L.marker([latitude, longitude]).addTo(map)
      .bindPopup('<b>Report Location</b><br>' + '{{ report.incident_type }}')
      .openPopup();
  </script>

</body>

</html>